{
	"$schema": "https://schema.railpack.com",
	"packages": {
		"node": "24"
	},
	"steps": {
		"install": {
			"commands": [
				"...",
				"bundle config set deployment true",
				"bundle config set without development test",
				"bundle install --jobs 1"
			]
		},
		"install:node": {
			"commands": [
				"mkdir -p /app/react-client/node_modules/.cache",
				"touch /app/react-client/node_modules/.keep",
				{
					"src": "package.json",
					"dest": "package.json"
				},
				{
					"src": "react-client/package.json",
					"dest": "react-client/package.json"
				},
				{
					"src": "react-client/pnpm-lock.yaml",
					"dest": "react-client/pnpm-lock.yaml"
				},
				"npm i -g corepack@latest && corepack enable && corepack prepare --activate",
				"pnpm railway-install",
			]
		},
		"build": {
			"commands": [
				"...",
				"ls -a",
				"ls -a react-client",
				"ls -a react-client/node_modules",
				"ls -a react-client/node_modules/.bin",
				"pnpm railway-deploy",
				"bundle exec rake assets:precompile"
			]
		},
		"release": {
			"inputs": [
				{
					"step": "build"
				}
			],
			"commands": [
				"bin/rake db:migrate"
			]
		}
	}
}
